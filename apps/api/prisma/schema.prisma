generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SyncStatus {
  PENDING
  PROCESSING
  RETRYING
  SUCCESS
  FAILED
}

enum Role {
  industry
  consumer
}

enum IdType {
  cn_id
  passport
  other
}

model Submission {
  id            String     @id @default(uuid())
  clientRequestId String   @unique @db.VarChar(64)
  traceId       String     @db.VarChar(64)
  role          Role
  idType        IdType
  name          String     @db.VarChar(64)
  title         String     @db.VarChar(64)
  company       String     @db.VarChar(128)
  phoneEnc      String     @db.Text
  phoneHash     String     @db.VarChar(64)
  idEnc         String     @db.Text
  idHash        String     @db.VarChar(64)
  businessType  String?    @db.VarChar(64)
  department    String?    @db.VarChar(64)
  proofUrls     Json?      @db.JsonB
  syncStatus    SyncStatus @default(PENDING)
  syncError     String?    @db.Text
  syncAttempts  Int        @default(0)
  lastAttemptAt DateTime?
  nextAttemptAt DateTime?
  feishuRecordId String?   @db.VarChar(64)
  clientIp      String?    @db.VarChar(64)
  userAgent     String?    @db.VarChar(256)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([phoneHash])
  @@index([idHash])
  @@index([syncStatus, createdAt])
  @@index([nextAttemptAt])
}
